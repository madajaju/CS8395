1
00:00:00,033 --> 00:00:02,600
Okay.
This lecture is on cohesion and coupling.

2
00:00:02,600 --> 00:00:05,600
And these are key fundamental software
engineering things

3
00:00:05,933 --> 00:00:07,766
that you need to understand.

4
00:00:07,766 --> 00:00:11,266
And make sure that you are always
keep it in mind when you're designing

5
00:00:11,266 --> 00:00:13,166
your microservice architectures.

6
00:00:13,166 --> 00:00:17,100
So the golden rule on
these is high cohesion.

7
00:00:17,333 --> 00:00:18,766
And low coupling.

8
00:00:18,766 --> 00:00:21,733
So what do what do these really mean.

9
00:00:21,733 --> 00:00:23,933
Well let's go through that.

10
00:00:23,933 --> 00:00:26,933
Let's define what cohesion is
and then what coupling is.

11
00:00:27,166 --> 00:00:30,733
And then let's identify
any risk by having

12
00:00:31,200 --> 00:00:34,000
low cohesion and high coupling

13
00:00:34,000 --> 00:00:37,766
or having any kind of mid-ground compared
to high cohesion and low coupling.

14
00:00:37,766 --> 00:00:41,066
And there's some trade offs
that you have to deal with.

15
00:00:41,166 --> 00:00:44,166
Here
complexity is one of those big trade offs.

16
00:00:44,533 --> 00:00:46,333
So cohesion.

17
00:00:46,333 --> 00:00:49,333
When things belong together
they stay together.

18
00:00:49,533 --> 00:00:52,166
So that's the
that's the best way to think of it.

19
00:00:52,166 --> 00:00:56,733
So high cohesion is a service
that does one thing really, really well.

20
00:00:57,100 --> 00:01:00,133
It does one thing like a payment service

21
00:01:00,766 --> 00:01:03,566
or an inventory service

22
00:01:03,566 --> 00:01:07,933
or a oh, a video serving service.

23
00:01:07,933 --> 00:01:10,433
Right. Something that serves up videos.

24
00:01:10,433 --> 00:01:13,166
It does one thing
and does it really well, right.

25
00:01:13,166 --> 00:01:16,200
Low cohesion is where I've got multiple

26
00:01:16,200 --> 00:01:19,600
unrelated responsibilities
that are doing something together.

27
00:01:19,800 --> 00:01:25,133
Like if I have a management service where
it manages users and catalogs and emails.

28
00:01:25,400 --> 00:01:29,066
So think of it almost like
go back to your object oriented

29
00:01:29,066 --> 00:01:32,266
programing and analysis
and design concepts.

30
00:01:33,133 --> 00:01:36,600
If I have high cohesion,
it typically means

31
00:01:36,600 --> 00:01:40,866
that I've got everything
that can act on those individual objects.

32
00:01:41,233 --> 00:01:42,900
All all together, right?

33
00:01:42,900 --> 00:01:44,966
If it's doing one thing right.

34
00:01:44,966 --> 00:01:47,133
Payment service. Right.

35
00:01:47,133 --> 00:01:51,233
A management service it's managing users
catalogs and emails.

36
00:01:51,233 --> 00:01:54,266
That's very horizontal
thinking where, hey,

37
00:01:54,266 --> 00:01:59,433
I've got a more functional
management is the is it?

38
00:01:59,433 --> 00:02:02,533
So if you have verbs and things like that
and as across multiple

39
00:02:02,533 --> 00:02:05,566
types of objects, 
tends to be low cohesion.

40
00:02:05,566 --> 00:02:10,733
So think of cohesion more from the data
side than from the functional side.

41
00:02:11,333 --> 00:02:14,933
And you'll typically go
pretty pretty good in that direction

42
00:02:15,966 --> 00:02:17,366
of why it matters.

43
00:02:17,366 --> 00:02:22,733
Well it mostly matters because it's much
easier to understand and test and maintain

44
00:02:23,000 --> 00:02:27,133
because I'm dealing with one, 
type of object

45
00:02:27,133 --> 00:02:32,333
or one concept that,
I'm working with instead of,

46
00:02:32,766 --> 00:02:37,333
a bunch of different, things,
and also means that I can isolate changes

47
00:02:37,666 --> 00:02:41,633
without it affecting other things,
like a change to a payment system.

48
00:02:41,633 --> 00:02:47,333
Doesn't it affect breaking emails or users
or things like that?

49
00:02:47,333 --> 00:02:50,666
So instead of grouping everything
in a big management service

50
00:02:50,966 --> 00:02:53,966
where one change
can affect a whole bunch of things.

51
00:02:54,133 --> 00:02:56,933
If you have that,
then you know that you've got,

52
00:02:56,933 --> 00:03:01,000
low cohesion and high coupling,
which is the bad.

53
00:03:01,000 --> 00:03:03,733
That's very bad. You don't want that.

54
00:03:03,733 --> 00:03:05,033
So let's talk about coupling.

55
00:03:05,033 --> 00:03:08,100
Coupling
means that you have a dependency on others

56
00:03:08,533 --> 00:03:10,200
and you're not very independent.

57
00:03:10,200 --> 00:03:15,200
Now with software we want
we want, low coupling so that,

58
00:03:15,500 --> 00:03:19,666
if one change occurs,
it doesn't affect, other things.

59
00:03:19,866 --> 00:03:22,700
Now there's lots of different ways
that coupling happens.

60
00:03:22,700 --> 00:03:23,700
Right.

61
00:03:23,700 --> 00:03:28,466
But, it's important to understand that, 
all those different ways.

62
00:03:28,466 --> 00:03:32,066
So you cannot inadvertently create
a coupling between two services.

63
00:03:32,366 --> 00:03:37,133
So loose or low coupling means
that services can change independently.

64
00:03:37,466 --> 00:03:39,900
Via stable APIs.

65
00:03:39,900 --> 00:03:43,233
Now, some I've seen, coupling

66
00:03:43,233 --> 00:03:47,033
where the APIs are so tightly coupled.

67
00:03:47,400 --> 00:03:49,800
Right,
that one change is affecting everyone.

68
00:03:49,800 --> 00:03:52,833
And I also see it with like,
shared databases.

69
00:03:53,066 --> 00:03:56,000
Oh, the database schema changed for user.

70
00:03:56,000 --> 00:03:57,566
Why did that affect payments.

71
00:03:57,566 --> 00:03:59,700
Shouldn't
shouldn't affect payments at all.

72
00:03:59,700 --> 00:04:02,366
If you do
then you know you've got coupling there.

73
00:04:02,366 --> 00:04:04,700
High coupling means that one changes.

74
00:04:04,700 --> 00:04:09,466
Can one change can force multiple changes
throughout, the architecture.

75
00:04:09,700 --> 00:04:13,333
So that tends to mean
you've got a bad architecture.

76
00:04:13,766 --> 00:04:17,800
And we've seen we've seen high
coupling in major

77
00:04:17,800 --> 00:04:21,466
cloud service providers
that cause massive power outages.

78
00:04:21,900 --> 00:04:25,366
And some of these couplings
were inadvertent, like,

79
00:04:25,366 --> 00:04:28,400
high coupling on,

80
00:04:28,400 --> 00:04:31,400
domain name services
or dynamic naming services.

81
00:04:31,600 --> 00:04:34,266
Right. Poi, I have high coupling.

82
00:04:34,266 --> 00:04:36,366
All of a sudden
everything falls apart and fails.

83
00:04:36,366 --> 00:04:37,533
That's a bad design.

84
00:04:38,966 --> 00:04:39,733
All right, so here's

85
00:04:39,733 --> 00:04:43,766
some, coupling to avoid implementation.

86
00:04:43,766 --> 00:04:44,166
Coupling?

87
00:04:44,166 --> 00:04:47,600
Meaning I have dependency on internals
between different things.

88
00:04:47,600 --> 00:04:51,566
Now, we see this primarily
in monolithic programs or

89
00:04:51,566 --> 00:04:56,033
modular monolithic, where I've got central
libraries that I use all over the place

90
00:04:56,033 --> 00:04:59,033
because, hey,
that was something we were taught to do.

91
00:04:59,333 --> 00:05:00,533
That's still really good.

92
00:05:00,533 --> 00:05:05,133
But you've created a coupling, so
you have to understand the that dependency

93
00:05:05,133 --> 00:05:10,800
and make sure that you, avoid coupling,
between two modules.

94
00:05:11,166 --> 00:05:13,766
If instead put a third one in there.

95
00:05:13,766 --> 00:05:15,433
So that decouples

96
00:05:15,433 --> 00:05:19,000
these two modules from each other,
but inadvertently through the third one.

97
00:05:19,200 --> 00:05:21,566
But your changes can be more isolated.

98
00:05:21,566 --> 00:05:25,700
You can have temporal, coupling

99
00:05:25,933 --> 00:05:30,533
where, all the services are required
to be online at once.

100
00:05:31,466 --> 00:05:36,100
This one I have seen time and time again,
as sometimes you universally put them in

101
00:05:36,400 --> 00:05:39,266
as an admin check, where I'm saying, hey,

102
00:05:39,266 --> 00:05:43,100
I'm going to do an admin check
before I send anything across.

103
00:05:43,100 --> 00:05:45,766
And then you can get a propagating,

104
00:05:45,766 --> 00:05:49,000
health check that now
tightly coupled everything together.

105
00:05:49,233 --> 00:05:51,600
Typically a bad idea, right?

106
00:05:51,600 --> 00:05:55,933
Deployment
coupling is if you deploy a microservice

107
00:05:55,933 --> 00:06:01,633
and it won't operate at all
without another microservice, there

108
00:06:01,666 --> 00:06:04,633
you have a deployment coupling
that's going on.

109
00:06:04,633 --> 00:06:06,266
So you got to watch out for that.

110
00:06:06,266 --> 00:06:09,266
And then domain
this is when models are too intertwined.

111
00:06:09,600 --> 00:06:12,866
Whether it's your user model
compared to your,

112
00:06:12,866 --> 00:06:16,933
payment model
or your inventory model, if you can have

113
00:06:17,966 --> 00:06:19,333
foreign key fields

114
00:06:19,333 --> 00:06:22,700
in there that can, introduce coupling
if you're not careful.

115
00:06:23,066 --> 00:06:25,933
So you got to watch out for those.

116
00:06:25,933 --> 00:06:26,366
Okay.

117
00:06:26,366 --> 00:06:29,633
So the relationship between cohesion
and and coupling,

118
00:06:29,966 --> 00:06:33,900
if I have low cohesion
it tends to lead to high coupling.

119
00:06:33,900 --> 00:06:35,300
But not always.

120
00:06:35,300 --> 00:06:37,700
But the relationship
is pretty strong there.

121
00:06:37,700 --> 00:06:40,866
So if a service lacks clear purpose
a lot of times

122
00:06:40,866 --> 00:06:44,700
it must reach out to someone else's,
logic.

123
00:06:44,700 --> 00:06:45,900
And you've now created,

124
00:06:45,900 --> 00:06:49,166
dependency or a coupling,
so you got to watch out for that.

125
00:06:49,966 --> 00:06:54,266
It creates just this really complex
web of tight dependencies,

126
00:06:54,666 --> 00:06:58,066
and it can be very difficult to debug, 
very difficult

127
00:06:58,066 --> 00:07:01,466
to build,
very difficult to maintain as well.

128
00:07:01,466 --> 00:07:04,466
So you gotta watch out for that.

129
00:07:05,166 --> 00:07:06,366
Oh, here's a, here's

130
00:07:06,366 --> 00:07:10,000
a great world example of a user service
where I've got,

131
00:07:10,700 --> 00:07:15,333
authorization, profiling and billing
all in one service.

132
00:07:16,166 --> 00:07:18,266
Now, these really should be,

133
00:07:18,266 --> 00:07:21,033
three different services
when you think about it.

134
00:07:21,033 --> 00:07:21,566
Right?

135
00:07:21,566 --> 00:07:25,766
Because if I make any changes
to the, billing updates, it would require

136
00:07:25,766 --> 00:07:31,333
redeployment of your authorization logic,
which could be very high risk.

137
00:07:31,333 --> 00:07:32,000
Right.

138
00:07:32,000 --> 00:07:36,933
So the fix is to extract that out
into its own service.

139
00:07:37,566 --> 00:07:41,366
Now my authorization is standalone,

140
00:07:41,366 --> 00:07:44,066
the profile standalone
and the billing is standalone.

141
00:07:44,066 --> 00:07:47,066
So now they are highly cohesive.

142
00:07:47,533 --> 00:07:51,866
No, there'd be a tendency with this now
to move to something called Nano.

143
00:07:52,466 --> 00:07:54,366
Microservices or nano services.

144
00:07:54,366 --> 00:07:57,266
We'll talk about that in a little bit.
All right.

145
00:07:57,266 --> 00:07:57,566
All right.

146
00:07:57,566 --> 00:08:01,133
So for assignment
one that, I have for you guys,

147
00:08:01,500 --> 00:08:06,300
make sure that your services
don't have more than one responsibility.

148
00:08:07,433 --> 00:08:09,566
So take
a look at it and think really hard.

149
00:08:09,566 --> 00:08:12,200
Does this have more than one
responsibility?

150
00:08:12,200 --> 00:08:15,100
Does, your open

151
00:08:15,100 --> 00:08:18,533
API spec leak database field names?

152
00:08:19,533 --> 00:08:22,000
You're doing an implementation
coupling then.

153
00:08:22,000 --> 00:08:27,233
So if, if you put in here, a foreign key

154
00:08:27,500 --> 00:08:32,033
that's a, that's a common one
I've seen where someone puts into the API,

155
00:08:32,266 --> 00:08:37,900
foreign key or a database
field name directly that typically is,

156
00:08:37,900 --> 00:08:42,833
an implementation coupling
that you're passing around through an API.

157
00:08:43,166 --> 00:08:45,866
So you gotta watch out for that.

158
00:08:45,866 --> 00:08:48,800
So the key here is

159
00:08:48,800 --> 00:08:51,166
high cohesion,

160
00:08:51,166 --> 00:08:53,033
low coupling.

161
00:08:53,033 --> 00:08:53,733
Right.

162
00:08:53,733 --> 00:08:56,500
Cohesion is that the services are small.

163
00:08:56,500 --> 00:08:59,133
And focus on one thing.

164
00:08:59,133 --> 00:09:02,266
And low coupling ensures
that they're fully autonomous.

165
00:09:02,266 --> 00:09:06,566
So you kind of balance this is
this is why this is kind of an art.

166
00:09:06,866 --> 00:09:09,833
You've got to balance
how small you make it without it

167
00:09:09,833 --> 00:09:13,366
having dependency
on other things to get its work done.

168
00:09:13,866 --> 00:09:14,966
And that's kind of

169
00:09:14,966 --> 00:09:17,966
you kind of move the bar up
and down on that one to figure it out.

170
00:09:18,366 --> 00:09:21,366
And you can tell that you have,
high coupling.

171
00:09:21,600 --> 00:09:25,766
If when you make one change, it ripples
through several different microservices.

172
00:09:26,233 --> 00:09:30,266
Or you can find that
you have low cohesion

173
00:09:30,566 --> 00:09:33,566
if your microservice can stand on its own,

174
00:09:33,666 --> 00:09:36,933
and be able to, to do its own work,

175
00:09:37,766 --> 00:09:39,833
without another microservice
sitting there.

176
00:09:39,833 --> 00:09:42,400
So that means
you probably have low cohesion

177
00:09:42,400 --> 00:09:45,400
and you've created some kind
of the high coupling, more than likely.

178
00:09:46,166 --> 00:09:49,566
So keep these things in mind
when you're out there designing your

179
00:09:49,566 --> 00:09:50,900
microservice architectures.
