= Environment Promotion
:revnumber: 1.0
:revealjs_theme: black
:revealjs_transition: slide
:revealjs_slideNumber: true
:revealjs_history: true

:revealjs_width: "100%"
:revealjs_height: "100%"

[.columns]
== 1. Motivation: Why Environment Promotion Exists

[.column]
--
Most teams run their software in multiple environments:

- **Development** for rapid iteration
- **Test / QA** for functional verification
- **Staging** for production-like validation
- **Production** for real users and real data
--

[.column]
--
.Disorganized paths to production
[plantuml, format=svg, width=100%]
----
@startuml
  title Disorganized Path to Production

left to right direction
  actor Developer
  node Development {
    Developer -> Development : Commit changes
  }
  node TestQA {
  }
  node Production {
  }
    Development -> TestQA : "Move to Test environment"
    TestQA --> Production : "Deploy to Production\nIt works in dev"

    Production <-- Development : "Move without validation"
@enduml
----
--

== 1b. Without Promotion

Without a disciplined way to move changes, teams face:

- Unrepeatable releases
- Unclear ownership for broken deployments
- Production changes that cannot be traced or rolled back

Environment promotion creates a **predictable, auditable path** from code change to production release.

== 2. Core Definition

**Environment promotion** means:

- The *same build artifact* moves forward through environments in a fixed order.
- Each environment provides additional validation and confidence.
- Only artifacts that pass required checks are eligible to move forward.

This idea is simple but powerful:

> The code you run in production is the same code that passed your tests and staging checks.


== 3. The Promotion Pipeline

[plantuml, format=svg, width=100%]
----
@startuml
title Promotion Pipeline
actor DevOps
DevOps -> Build : "Trigger build"
Build -> UnitTests : "Run unit tests"
UnitTests -> IntegrationTests : "Run integration tests"
IntegrationTests -> Test : "Deploy to test"
DevOps -> Staging : "Deploy to staging"
Staging -> Approval : "Final approval"
Approval -> Prod : "Deploy to production"
@enduml
----

[.columns]
== 4. Immutability: The Artifact Must Not Change

[.column]
--
To avoid common pitfalls:

- Build once
- Version the artifact
- Promote the exact same artifact across environments
--

[.column]
--
[plantuml, format=svg, width=100%]
----
@startuml
title Immutable Artifact
left to right direction
package "Build Environment" {
  [Build] --> [Artifact]
}

package "Promoted Environments" {
  [Test] <-- [Artifact]
  [Staging] <-- [Artifact]
  [Production] <-- [Artifact]
}
@enduml
----
--

[.column]
--
Common practices:

- Container images with tags
- Checksums or signatures
- Artifact registries
--

== 5. Configuration vs Code

Promoting the same artifact does not mean every environment is identical.

Differences can include:

- Database endpoints
- Feature flags
- API keys or secrets
- Scaling parameters

The rule is: **code stays the same, configuration changes**.

[.columns]
== 6. Deployment Strategies That Support Promotion

[.column]
--
Promotion pairs naturally with safer deployment strategies:

- **Blue/green deployment**
- **Canary release**
- **Feature flags**
--

[.column]
--
[plantuml, format=svg, width=100%]
----
@startuml
title Deployment Strategies
package "Deployments" {
  [Blue Environment] <--> [Green Environment] : "Switch traffic post validation"
}

package "Canary Release" {
  [Staging] --> [Production] : "5% of users"
}
@enduml
----
--

== 7. Verification at Each Stage

Each environment has a purpose:

- **Dev**: fast feedback
- **Test/QA**: automated tests
- **Staging**: production-like checks
- **Prod**: real-world performance

== 8. Approvals and Change Control

Some organizations require formal approvals:

- Release manager sign-off
- Security or compliance review

These steps ensure **accountability** and **risk management**.

== 9. Risks and Tradeoffs

Promotion introduces structure but also adds cost:

- **Slower feedback** if the pipeline is long
- **Bottlenecks** at manual approval stages

Common risks:

- **Environment drift**
- **Manual fixes** in prod that are not promoted back

== 10. Example Scenario

Consider a service that handles payments:

1. Developer merges code to main.
2. CI builds image `payments:2.4.1`.
3. Automated tests pass.
4. Same image is deployed to test and staging.
5. Canary release sends 5% of traffic to new version.
6. Rollback is easy if a bug appears.

== 11. Key Takeaways

- Promotion is a **disciplined path** from code to production.
- Maintain the same artifact across environments.
- Strong promotion depends on artifact immutability, configuration separation, and automated tests.
- Benefits include **predictable, safer releases**.
